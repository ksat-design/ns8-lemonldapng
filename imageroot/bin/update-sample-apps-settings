#!/usr/bin/env python3

#
# Copyright (C) 2025 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import os
import sys
import subprocess

# Check whether sample apps are enabled
sample_apps_enabled = os.getenv("SAMPLE_APPS_STATUS", "False") == "True"

# Set up base podman command
cli = [
    "podman", "exec", "lemonldapng-app",
    "/usr/share/lemonldap-ng/bin/lemonldap-ng-cli", "-yes", "1"
]

if sample_apps_enabled:
    print("Sample apps are enabled. Creating entries...", file=sys.stderr)

    subprocess.run(cli + [
        "set",
        "applicationList/applications1/type", "category",
        "applicationList/applications1/catname", "Sample applications",
        "applicationList/applications1/sample1/type", "application",
        "applicationList/applications1/sample1/options/description", "A sample application",
        "applicationList/applications1/sample1/options/display", "on",
        "applicationList/applications1/sample1/options/logo", "demo.png",
        "applicationList/applications1/sample1/options/name", "Test app 1",
        "applicationList/applications1/sample1/options/url", f"https://test1.{lemdomain}",
        "applicationList/applications1/type", "category",
        "applicationList/applications1/catname", "Sample applications",
        "applicationList/applications1/sample2/type", "application",
        "applicationList/applications1/sample2/options/description", "A sample application",
        "applicationList/applications1/sample2/options/display", "on",
        "applicationList/applications1/sample2/options/logo", "demo.png",
        "applicationList/applications1/sample2/options/name", "Test app 2",
        "applicationList/applications1/sample2/options/url", f"https://test2.{lemdomain}",
    ], check=True)

else:
    print("Sample apps are disabled. Removing entries...", file=sys.stderr)

    subprocess.run(cli + [
        "delKey",
        "applicationList/applications1", "sample1",
        "applicationList/applications1", "sample2",
        "applicationList", "applications1"
    ], check=True)
