#!/bin/bash

# Get the domain name from lemonldapng
lemdomain=$(podman exec lemonldapng-app /usr/share/lemonldap-ng/bin/lemonldap-ng-cli -yes 1 get domain | awk -F'= ' '{print $2}')

# Toggle control - pass "on" or "off" as first argument
toggle="apps_enabled"

# Define category key and name
category_key="applicationList/applications"
category_type="type"
category_name_key="catname"
category_name="Sample applications"
category_id="1sample" # the ID used for deletion

if [[ "$toggle" == "True" ]]; then
    echo "Adding category to LemonLDAP::NG for domain: $lemdomain"

    podman exec lemonldapng-app /usr/share/lemonldap-ng/bin/lemonldap-ng-cli -yes 1 \
        addKey \
        "$category_key" "$category_type" category \
        "$category_key" "$category_name_key" "$category_name"

elif [[ "$toggle" == "False" ]]; then
    echo "Removing category from LemonLDAP::NG for domain: $lemdomain"

    podman exec lemonldapng-app /usr/share/lemonldap-ng/bin/lemonldap-ng-cli -yes 1 \
        delKey \
        "applicationList" "$category_id"
else
    echo "Usage: $0 [on|off]"
    exit 1
fi
