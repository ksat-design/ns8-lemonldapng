#!/usr/bin/env python3

import os
import subprocess
import sys

# Check if sample apps are enabled
sample_apps_enabled = os.getenv("SAMPLE_APPS_STATUS", "True").lower() == "true"

if sample_apps_enabled:
    print("Sample apps are enabled â€” skipping deletion.")
    sys.exit(0)

# Define deletion commands as a list of subcommands
delete_commands = [
    ["applicationList/1sample/test1"],
    ["applicationList/1sample/test2"],
    ["applicationList/1sample"]
]

# Base command
base_command = [
    "podman", "exec", "lemonldapng-app",
    "/usr/share/lemonldap-ng/bin/lemonldap-ng-cli", "-yes", "1", "delKey"
]

# Execute each delete command
for path in delete_commands:
    full_command = base_command + path
    try:
        print(f"Deleting: {path[0]}")
        result = subprocess.run(full_command, check=True, capture_output=True, text=True)
        print(result.stdout.strip())
    except subprocess.CalledProcessError as e:
        print(f"Failed to delete {path[0]}:", file=sys.stderr)
        print(e.stderr.strip(), file=sys.stderr)
