#!/usr/bin/env python3

#
# Copyright (C) 2025 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import subprocess
import sys

# Get the domain using lemonldap-ng-cli
try:
    lemdomain = subprocess.run(
        [
            "podman", "exec", "lemonldapng-app",
            "/usr/share/lemonldap-ng/bin/lemonldap-ng-cli", "-yes", "1", "get", "domain"
        ],
        capture_output=True, text=True, check=True
    ).stdout.strip().replace("domain = ", "")
    print(f"Domain retrieved: {lemdomain}", file=sys.stderr)
except subprocess.CalledProcessError as e:
    print(f"Failed to retrieve domain: {e}", file=sys.stderr)
    sys.exit(1)

# Set portal branding and options
set_command = [
    "podman", "exec", "lemonldapng-app",
    "/usr/share/lemonldap-ng/bin/lemonldap-ng-cli", "-yes", "1", "set",
    "portalMainLogo", "CustomTheme/nethserver.png",
    "portalCustomCss", "CustomTheme/custom.css",
    "portalFavicon", "CustomTheme/favicon.ico",
    "portalSkinBackground", "nethbackground.png",
    "portalDisplayRegister", "0"
]

try:
    subprocess.run(set_command, check=True)
    print("Portal settings applied.", file=sys.stderr)
except subprocess.CalledProcessError as e:
    print(f"Error executing command: {e}", file=sys.stderr)
    sys.exit(1)
